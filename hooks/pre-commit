#!/usr/bin/env bash
set -e

ROOT_DIR="$(git rev-parse --show-toplevel)"
PHP_IR_DIR="$ROOT_DIR/php-ir"

echo "üîç Running pre-commit checks..."

# Ensure php-ir exists
if [ ! -d "$PHP_IR_DIR" ]; then
  echo "‚ùå php-ir directory not found"
  exit 1
fi

cd "$PHP_IR_DIR"

# Ensure dependencies are installed
if [ ! -d "vendor" ]; then
  echo "‚ùå vendor/ not found. Run composer install first."
  exit 1
fi

echo "‚ñ∂ Running PHP-CS-Fixer (dry-run)..."
vendor/bin/php-cs-fixer fix --dry-run --diff
echo "‚úî PHP-CS-Fixer passed"

echo "‚ñ∂ Running PHPStan..."
vendor/bin/phpstan analyse
echo "‚úî PHPStan passed"

echo "‚úÖ Pre-commit checks passed"