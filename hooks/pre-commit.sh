#!/usr/bin/env bash

set -euo pipefail

# ---------------------------------------------------------------------------
# Resolve repository root
# ---------------------------------------------------------------------------

ROOT_DIR="$(git rev-parse --show-toplevel)"
cd "$ROOT_DIR"

# ---------------------------------------------------------------------------
# Sanity checks
# ---------------------------------------------------------------------------

if [ ! -d "vendor" ]; then
  echo "❌ vendor/ not found. Run composer install first."
  exit 1
fi

# ---------------------------------------------------------------------------
# PHP-CS-Fixer
# ---------------------------------------------------------------------------

echo "▶ Running PHP-CS-Fixer (dry-run)..."
vendor/bin/php-cs-fixer fix --dry-run --diff
echo "✔ PHP-CS-Fixer passed"

# ---------------------------------------------------------------------------
# PHPStan
# ---------------------------------------------------------------------------

echo "▶ Running PHPStan..."
vendor/bin/phpstan analyse
echo "✔ PHPStan passed"

# ---------------------------------------------------------------------------
# Done
# ---------------------------------------------------------------------------

echo "✅ Pre-commit checks passed"